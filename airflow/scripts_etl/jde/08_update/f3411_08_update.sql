-- Apply updates from upsert table onto rep new table
UPDATE rep_jde.f3411_new
SET
	[sys_file_name] = cdc.[sys_file_name]
	,[sys_file_ln] = cdc.[sys_file_ln]
	,[sys_extract_dt] = cdc.[sys_extract_dt]
	,[sys_cdc_dt] = cdc.[sys_cdc_dt]
	,[sys_cdc_scn] = cdc.[sys_cdc_scn]
	,[sys_cdc_operation_type] = cdc.[sys_cdc_operation_type]
	,[sys_cdc_before_after] = cdc.[sys_cdc_before_after]
	,[sys_line_modified_ind] = cdc.[sys_line_modified_ind]
	,[mmukid] = cdc.[mmukid]
	,[mmitm] = cdc.[mmitm]
	,[mmmcu] = cdc.[mmmcu]
	,[mmmcu_conv] = cdc.[mmmcu_conv]
	,[mmmmcu] = cdc.[mmmmcu]
	,[mmmmcu_conv] = cdc.[mmmmcu_conv]
	,[mmmsgt] = cdc.[mmmsgt]
	,[mmmsga] = cdc.[mmmsga]
	,[mmhcld] = cdc.[mmhcld]
	,[mmkcoo] = cdc.[mmkcoo]
	,[mmkcoo_conv] = cdc.[mmkcoo_conv]
	,[mmdoco] = cdc.[mmdoco]
	,[mmdcto] = cdc.[mmdcto]
	,[mmlnid] = cdc.[mmlnid]
	,[mmlnid_conv] = cdc.[mmlnid_conv]
	,[mmsfxo] = cdc.[mmsfxo]
	,[mmsfxo_conv] = cdc.[mmsfxo_conv]
	,[mmdsc1] = cdc.[mmdsc1]
	,[mmdsc1_conv] = cdc.[mmdsc1_conv]
	,[mmtrqt] = cdc.[mmtrqt]
	,[mmtrqt_conv] = cdc.[mmtrqt_conv]
	,[mmvend] = cdc.[mmvend]
	,[mmvend_conv] = cdc.[mmvend_conv]
	,[mmdrqj] = cdc.[mmdrqj]
	,[mmdrqj_conv] = cdc.[mmdrqj_conv]
	,[mmstrt] = cdc.[mmstrt]
	,[mmstrt_conv] = cdc.[mmstrt_conv]
	,[mmrstj] = cdc.[mmrstj]
	,[mmrstj_conv] = cdc.[mmrstj_conv]
	,[mmrrqj] = cdc.[mmrrqj]
	,[mmrrqj_conv] = cdc.[mmrrqj_conv]
	,[mmupmj] = cdc.[mmupmj]
	,[mmupmj_conv] = cdc.[mmupmj_conv]
	,[mmtday] = cdc.[mmtday]
	,[mmuser] = cdc.[mmuser]
	,[mmuser_conv] = cdc.[mmuser_conv]
	,[mmjobn] = cdc.[mmjobn]
	,[mmjobn_conv] = cdc.[mmjobn_conv]
	,[mmpid] = cdc.[mmpid]
	,[mmpid_conv] = cdc.[mmpid_conv]
	,[mmredj] = cdc.[mmredj]
	,[mmredj_conv] = cdc.[mmredj_conv]
	,[mmoedj] = cdc.[mmoedj]
	,[mmoedj_conv] = cdc.[mmoedj_conv]
	,[mmline] = cdc.[mmline]
	,[mmline_conv] = cdc.[mmline_conv]
	,[mmprjm] = cdc.[mmprjm]
	,[mmprjm_conv] = cdc.[mmprjm_conv]
	,[mmsrdm] = cdc.[mmsrdm]
	,[mmsrdm_conv] = cdc.[mmsrdm_conv]
	,[mmostt] = cdc.[mmostt]
	,[mmostt_conv] = cdc.[mmostt_conv]
	,[mmlotn] = cdc.[mmlotn]
	,[mmlotn_conv] = cdc.[mmlotn_conv]
	,[mmpns] = cdc.[mmpns]
	,[mmpmpn] = cdc.[mmpmpn]
	,[mmpmpn_conv] = cdc.[mmpmpn_conv] -- exclude distribution column
FROM stg_jde.tmp_upsert_f3411_cdc cdc
WHERE
    rep_jde.f3411_new.sys_integration_id = cdc.sys_integration_id
    AND rep_jde.f3411_new.sys_cdc_scn < cdc.sys_cdc_scn 
OPTION ( LABEL = 'UPDATE_rep_jde.f3411_new AF:{{ task_instance_key_str }}' ) 

-- Apply updates from upsert table onto rep new table
UPDATE rep_jde.f4104_new
SET
	[sys_file_name] = cdc.[sys_file_name]
	,[sys_file_ln] = cdc.[sys_file_ln]
	,[sys_extract_dt] = cdc.[sys_extract_dt]
	,[sys_cdc_dt] = cdc.[sys_cdc_dt]
	,[sys_cdc_scn] = cdc.[sys_cdc_scn]
	,[sys_cdc_operation_type] = cdc.[sys_cdc_operation_type]
	,[sys_cdc_before_after] = cdc.[sys_cdc_before_after]
	,[sys_line_modified_ind] = cdc.[sys_line_modified_ind]
	,[ivan8] = cdc.[ivan8]
	,[ivxrt] = cdc.[ivxrt]
	,[ivitm] = cdc.[ivitm]
	,[ivexdj] = cdc.[ivexdj]
	,[ivexdj_conv] = cdc.[ivexdj_conv]
	,[iveftj] = cdc.[iveftj]
	,[iveftj_conv] = cdc.[iveftj_conv]
	,[ivmcu] = cdc.[ivmcu]
	,[ivmcu_conv] = cdc.[ivmcu_conv]
	,[ivcitm] = cdc.[ivcitm]
	,[ivcitm_conv] = cdc.[ivcitm_conv]
	,[ivdsc1] = cdc.[ivdsc1]
	,[ivdsc1_conv] = cdc.[ivdsc1_conv]
	,[ivdsc2] = cdc.[ivdsc2]
	,[ivdsc2_conv] = cdc.[ivdsc2_conv]
	,[ivaln] = cdc.[ivaln]
	,[ivaln_conv] = cdc.[ivaln_conv]
	,[ivlitm] = cdc.[ivlitm]
	,[ivlitm_conv] = cdc.[ivlitm_conv]
	,[ivaitm] = cdc.[ivaitm]
	,[ivaitm_conv] = cdc.[ivaitm_conv]
	,[ivurcd] = cdc.[ivurcd]
	,[ivurcd_conv] = cdc.[ivurcd_conv]
	,[ivurdt] = cdc.[ivurdt]
	,[ivurdt_conv] = cdc.[ivurdt_conv]
	,[ivurat] = cdc.[ivurat]
	,[ivurat_conv] = cdc.[ivurat_conv]
	,[ivurab] = cdc.[ivurab]
	,[ivurab_conv] = cdc.[ivurab_conv]
	,[ivurrf] = cdc.[ivurrf]
	,[ivurrf_conv] = cdc.[ivurrf_conv]
	,[ivuser] = cdc.[ivuser]
	,[ivuser_conv] = cdc.[ivuser_conv]
	,[ivpid] = cdc.[ivpid]
	,[ivpid_conv] = cdc.[ivpid_conv]
	,[ivjobn] = cdc.[ivjobn]
	,[ivjobn_conv] = cdc.[ivjobn_conv]
	,[ivupmj] = cdc.[ivupmj]
	,[ivupmj_conv] = cdc.[ivupmj_conv]
	,[ivtday] = cdc.[ivtday]
	,[ivrato] = cdc.[ivrato]
	,[ivrato_conv] = cdc.[ivrato_conv]
	,[ivapsp] = cdc.[ivapsp]
	,[ivapsp_conv] = cdc.[ivapsp_conv]
	,[ividem] = cdc.[ividem]
	,[ividem_conv] = cdc.[ividem_conv]
	,[ivapss] = cdc.[ivapss]
	,[ivapss_conv] = cdc.[ivapss_conv]
	,[ivcirv] = cdc.[ivcirv]
	,[ivcirv_conv] = cdc.[ivcirv_conv]
	,[ivadind] = cdc.[ivadind]
	,[ivbpind] = cdc.[ivbpind]
	,[ivcardno] = cdc.[ivcardno] -- exclude distribution column
FROM stg_jde.tmp_upsert_f4104_cdc cdc
WHERE
    rep_jde.f4104_new.sys_integration_id = cdc.sys_integration_id
    AND rep_jde.f4104_new.sys_cdc_scn < cdc.sys_cdc_scn 
OPTION ( LABEL = 'UPDATE_rep_jde.f4104_new AF:{{ task_instance_key_str }}' ) 

-- Apply updates from upsert table onto rep new table
UPDATE rep_jde_qat.f554217_new
SET
	[sys_file_name] = cdc.[sys_file_name]
	,[sys_file_ln] = cdc.[sys_file_ln]
	,[sys_extract_dt] = cdc.[sys_extract_dt]
	,[sys_cdc_dt] = cdc.[sys_cdc_dt]
	,[sys_cdc_scn] = cdc.[sys_cdc_scn]
	,[sys_cdc_operation_type] = cdc.[sys_cdc_operation_type]
	,[sys_cdc_before_after] = cdc.[sys_cdc_before_after]
	,[sys_line_modified_ind] = cdc.[sys_line_modified_ind]
	,[span8] = cdc.[span8]
	,[spac06] = cdc.[spac06]
	,[spaddz] = cdc.[spaddz]
	,[spaddz_conv] = cdc.[spaddz_conv]
	,[spshan] = cdc.[spshan]
	,[spat1] = cdc.[spat1]
	,[spac01] = cdc.[spac01]
	,[spac02] = cdc.[spac02]
	,[spac03] = cdc.[spac03]
	,[spar1] = cdc.[spar1]
	,[spar1_conv] = cdc.[spar1_conv]
	,[spph1] = cdc.[spph1]
	,[spph1_conv] = cdc.[spph1_conv]
	,[spcmtb] = cdc.[spcmtb]
	,[spcmtb_conv] = cdc.[spcmtb_conv]
	,[spptmb] = cdc.[spptmb]
	,[spcmte] = cdc.[spcmte]
	,[spcmte_conv] = cdc.[spcmte_conv]
	,[spev01] = cdc.[spev01]
	,[spev01_conv] = cdc.[spev01_conv]
	,[spptme] = cdc.[spptme]
	,[spurab] = cdc.[spurab]
	,[spurab_conv] = cdc.[spurab_conv]
	,[spupmj] = cdc.[spupmj]
	,[spupmj_conv] = cdc.[spupmj_conv]
	,[spupmt] = cdc.[spupmt]
	,[spjobn] = cdc.[spjobn]
	,[spjobn_conv] = cdc.[spjobn_conv]
	,[sppid] = cdc.[sppid]
	,[sppid_conv] = cdc.[sppid_conv]
	,[spuser] = cdc.[spuser]
	,[spuser_conv] = cdc.[spuser_conv]
	,[spmcu] = cdc.[spmcu]
	,[spmcu_conv] = cdc.[spmcu_conv]
	,[sprp24] = cdc.[sprp24]
	,[spy55char1] = cdc.[spy55char1]
	,[spy55char1_conv] = cdc.[spy55char1_conv]
	,[spy55char2] = cdc.[spy55char2]
	,[spy55char2_conv] = cdc.[spy55char2_conv]
	,[spy55strg1] = cdc.[spy55strg1]
	,[spy55strg1_conv] = cdc.[spy55strg1_conv]
	,[spy55strg2] = cdc.[spy55strg2]
	,[spy55strg2_conv] = cdc.[spy55strg2_conv]
	,[spy55amnt1] = cdc.[spy55amnt1]
	,[spy55amnt1_conv] = cdc.[spy55amnt1_conv]
	,[spy55amnt2] = cdc.[spy55amnt2]
	,[spy55amnt2_conv] = cdc.[spy55amnt2_conv]
	,[spy55time1] = cdc.[spy55time1]
	,[spy55time2] = cdc.[spy55time2]
	,[spy55date1] = cdc.[spy55date1]
	,[spy55date1_conv] = cdc.[spy55date1_conv]
	,[spy55date2] = cdc.[spy55date2]
	,[spy55date2_conv] = cdc.[spy55date2_conv]
	,[spcrtj] = cdc.[spcrtj]
	,[spcrtj_conv] = cdc.[spcrtj_conv]
	,[spterm] = cdc.[spterm]
	,[spterm_conv] = cdc.[spterm_conv]
	,[sppa8] = cdc.[sppa8]
	,[sptx1] = cdc.[sptx1]
	,[sptx1_conv] = cdc.[sptx1_conv]
	,[sptax] = cdc.[sptax]
	,[sptax_conv] = cdc.[sptax_conv]
	,[spaddznh] = cdc.[spaddznh]
	,[spaddznh_conv] = cdc.[spaddznh_conv] -- exclude distribution column
FROM stg_jde_qat.tmp_upsert_f554217_cdc cdc
WHERE
    rep_jde_qat.f554217_new.sys_integration_id = cdc.sys_integration_id
    AND rep_jde_qat.f554217_new.sys_cdc_scn < cdc.sys_cdc_scn 
OPTION ( LABEL = 'UPDATE_rep_jde_qat.f554217_new AF:{{ task_instance_key_str }}' ) 

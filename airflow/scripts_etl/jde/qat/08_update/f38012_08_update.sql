-- Apply updates from upsert table onto rep new table
UPDATE rep_jde_qat.f38012_new
SET
	[sys_file_name] = cdc.[sys_file_name]
	,[sys_file_ln] = cdc.[sys_file_ln]
	,[sys_extract_dt] = cdc.[sys_extract_dt]
	,[sys_cdc_dt] = cdc.[sys_cdc_dt]
	,[sys_cdc_scn] = cdc.[sys_cdc_scn]
	,[sys_cdc_operation_type] = cdc.[sys_cdc_operation_type]
	,[sys_cdc_before_after] = cdc.[sys_cdc_before_after]
	,[sys_line_modified_ind] = cdc.[sys_line_modified_ind]
	,[dpdmct] = cdc.[dpdmct]
	,[dpdmct_conv] = cdc.[dpdmct_conv]
	,[dpdmcs] = cdc.[dpdmcs]
	,[dpitm] = cdc.[dpitm]
	,[dpdto] = cdc.[dpdto]
	,[dpdes] = cdc.[dpdes]
	,[dpdes_conv] = cdc.[dpdes_conv]
	,[dpdesy] = cdc.[dpdesy]
	,[dpseq] = cdc.[dpseq]
	,[dppsr] = cdc.[dppsr]
	,[dppsr_conv] = cdc.[dppsr_conv]
	,[dppsry] = cdc.[dppsry]
	,[dpcnqy] = cdc.[dpcnqy]
	,[dpcnqt] = cdc.[dpcnqt]
	,[dpcnqt_conv] = cdc.[dpcnqt_conv]
	,[dpaa] = cdc.[dpaa]
	,[dpaa_conv] = cdc.[dpaa_conv]
	,[dpcrcd] = cdc.[dpcrcd]
	,[dpcrcd_conv] = cdc.[dpcrcd_conv]
	,[dpuom] = cdc.[dpuom]
	,[dpminq] = cdc.[dpminq]
	,[dpminq_conv] = cdc.[dpminq_conv]
	,[dpmaxq] = cdc.[dpmaxq]
	,[dpmaxq_conv] = cdc.[dpmaxq_conv]
	,[dpqbal] = cdc.[dpqbal]
	,[dpqbal_conv] = cdc.[dpqbal_conv]
	,[dpqcom] = cdc.[dpqcom]
	,[dpqcom_conv] = cdc.[dpqcom_conv]
	,[dpeftj] = cdc.[dpeftj]
	,[dpeftj_conv] = cdc.[dpeftj_conv]
	,[dpexdj] = cdc.[dpexdj]
	,[dpexdj_conv] = cdc.[dpexdj_conv]
	,[dptv01] = cdc.[dptv01]
	,[dptv01_conv] = cdc.[dptv01_conv]
	,[dptv02] = cdc.[dptv02]
	,[dptv02_conv] = cdc.[dptv02_conv]
	,[dptv03] = cdc.[dptv03]
	,[dptv03_conv] = cdc.[dptv03_conv]
	,[dpqty1] = cdc.[dpqty1]
	,[dpqty1_conv] = cdc.[dpqty1_conv]
	,[dptvum] = cdc.[dptvum]
	,[dpurcd] = cdc.[dpurcd]
	,[dpurcd_conv] = cdc.[dpurcd_conv]
	,[dpurdt] = cdc.[dpurdt]
	,[dpurdt_conv] = cdc.[dpurdt_conv]
	,[dpurab] = cdc.[dpurab]
	,[dpurab_conv] = cdc.[dpurab_conv]
	,[dpurrf] = cdc.[dpurrf]
	,[dpurrf_conv] = cdc.[dpurrf_conv]
	,[dpuser] = cdc.[dpuser]
	,[dpuser_conv] = cdc.[dpuser_conv]
	,[dppid] = cdc.[dppid]
	,[dppid_conv] = cdc.[dppid_conv]
	,[dpjobn] = cdc.[dpjobn]
	,[dpjobn_conv] = cdc.[dpjobn_conv]
	,[dpupmj] = cdc.[dpupmj]
	,[dpupmj_conv] = cdc.[dpupmj_conv]
	,[dptday] = cdc.[dptday] -- exclude distribution column
FROM stg_jde_qat.tmp_upsert_f38012_cdc cdc
WHERE
    rep_jde_qat.f38012_new.sys_integration_id = cdc.sys_integration_id
    AND rep_jde_qat.f38012_new.sys_cdc_scn < cdc.sys_cdc_scn 
OPTION ( LABEL = 'UPDATE_rep_jde_qat.f38012_new AF:{{ task_instance_key_str }}' ) 

-- Apply updates from upsert table onto rep new table
UPDATE rep_jde_qat.f4072_new
SET
	[sys_file_name] = cdc.[sys_file_name]
	,[sys_file_ln] = cdc.[sys_file_ln]
	,[sys_extract_dt] = cdc.[sys_extract_dt]
	,[sys_cdc_dt] = cdc.[sys_cdc_dt]
	,[sys_cdc_scn] = cdc.[sys_cdc_scn]
	,[sys_cdc_operation_type] = cdc.[sys_cdc_operation_type]
	,[sys_cdc_before_after] = cdc.[sys_cdc_before_after]
	,[sys_line_modified_ind] = cdc.[sys_line_modified_ind]
	,[adast] = cdc.[adast]
	,[aditm] = cdc.[aditm]
	,[adlitm] = cdc.[adlitm]
	,[adlitm_conv] = cdc.[adlitm_conv]
	,[adaitm] = cdc.[adaitm]
	,[adaitm_conv] = cdc.[adaitm_conv]
	,[adan8] = cdc.[adan8]
	,[adigid] = cdc.[adigid]
	,[adigid_conv] = cdc.[adigid_conv]
	,[adcgid] = cdc.[adcgid]
	,[adcgid_conv] = cdc.[adcgid_conv]
	,[adogid] = cdc.[adogid]
	,[adogid_conv] = cdc.[adogid_conv]
	,[adcrcd] = cdc.[adcrcd]
	,[adcrcd_conv] = cdc.[adcrcd_conv]
	,[aduom] = cdc.[aduom]
	,[admnq] = cdc.[admnq]
	,[admnq_conv] = cdc.[admnq_conv]
	,[adeftj] = cdc.[adeftj]
	,[adeftj_conv] = cdc.[adeftj_conv]
	,[adexdj] = cdc.[adexdj]
	,[adexdj_conv] = cdc.[adexdj_conv]
	,[adbscd] = cdc.[adbscd]
	,[adledg] = cdc.[adledg]
	,[adfrmn] = cdc.[adfrmn]
	,[adfvtr] = cdc.[adfvtr]
	,[adfvtr_conv] = cdc.[adfvtr_conv]
	,[adfgy] = cdc.[adfgy]
	,[adfgy_conv] = cdc.[adfgy_conv]
	,[adatid] = cdc.[adatid]
	,[adurcd] = cdc.[adurcd]
	,[adurcd_conv] = cdc.[adurcd_conv]
	,[adurdt] = cdc.[adurdt]
	,[adurdt_conv] = cdc.[adurdt_conv]
	,[adurat] = cdc.[adurat]
	,[adurat_conv] = cdc.[adurat_conv]
	,[adurab] = cdc.[adurab]
	,[adurab_conv] = cdc.[adurab_conv]
	,[adurrf] = cdc.[adurrf]
	,[adurrf_conv] = cdc.[adurrf_conv]
	,[adnbrord] = cdc.[adnbrord]
	,[adnbrord_conv] = cdc.[adnbrord_conv]
	,[aduomvid] = cdc.[aduomvid]
	,[adfvum] = cdc.[adfvum]
	,[adpartfg] = cdc.[adpartfg]
	,[adpartfg_conv] = cdc.[adpartfg_conv]
	,[adaprs] = cdc.[adaprs]
	,[aduser] = cdc.[aduser]
	,[aduser_conv] = cdc.[aduser_conv]
	,[adpid] = cdc.[adpid]
	,[adpid_conv] = cdc.[adpid_conv]
	,[adjobn] = cdc.[adjobn]
	,[adjobn_conv] = cdc.[adjobn_conv]
	,[adupmj] = cdc.[adupmj]
	,[adupmj_conv] = cdc.[adupmj_conv]
	,[adtday] = cdc.[adtday]
	,[adbktpid] = cdc.[adbktpid]
	,[adbktpid_conv] = cdc.[adbktpid_conv]
	,[adcrcdvid] = cdc.[adcrcdvid]
	,[adcrcdvid_conv] = cdc.[adcrcdvid_conv]
	,[adrulename] = cdc.[adrulename]
	,[adrulename_conv] = cdc.[adrulename_conv] -- exclude distribution column
FROM stg_jde_qat.tmp_upsert_f4072_cdc cdc
WHERE
    rep_jde_qat.f4072_new.sys_integration_id = cdc.sys_integration_id
    AND rep_jde_qat.f4072_new.sys_cdc_scn < cdc.sys_cdc_scn 
OPTION ( LABEL = 'UPDATE_rep_jde_qat.f4072_new AF:{{ task_instance_key_str }}' ) 

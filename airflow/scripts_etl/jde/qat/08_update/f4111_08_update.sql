-- Apply updates from upsert table onto rep new table
UPDATE rep_jde_qat.f4111_new
SET
	[sys_file_name] = cdc.[sys_file_name]
	,[sys_file_ln] = cdc.[sys_file_ln]
	,[sys_extract_dt] = cdc.[sys_extract_dt]
	,[sys_cdc_dt] = cdc.[sys_cdc_dt]
	,[sys_cdc_scn] = cdc.[sys_cdc_scn]
	,[sys_cdc_operation_type] = cdc.[sys_cdc_operation_type]
	,[sys_cdc_before_after] = cdc.[sys_cdc_before_after]
	,[sys_line_modified_ind] = cdc.[sys_line_modified_ind]
	,[ilnlin] = cdc.[ilnlin]
	,[ilitm] = cdc.[ilitm]
	,[illitm] = cdc.[illitm]
	,[illitm_conv] = cdc.[illitm_conv]
	,[ilaitm] = cdc.[ilaitm]
	,[ilaitm_conv] = cdc.[ilaitm_conv]
	,[ilmcu] = cdc.[ilmcu]
	,[ilmcu_conv] = cdc.[ilmcu_conv]
	,[illocn] = cdc.[illocn]
	,[illocn_conv] = cdc.[illocn_conv]
	,[illotn] = cdc.[illotn]
	,[illotn_conv] = cdc.[illotn_conv]
	,[ilplot] = cdc.[ilplot]
	,[ilplot_conv] = cdc.[ilplot_conv]
	,[ilstun] = cdc.[ilstun]
	,[illdsq] = cdc.[illdsq]
	,[iltrno] = cdc.[iltrno]
	,[ilfrto] = cdc.[ilfrto]
	,[ilfrto_conv] = cdc.[ilfrto_conv]
	,[illmcx] = cdc.[illmcx]
	,[illmcx_conv] = cdc.[illmcx_conv]
	,[illots] = cdc.[illots]
	,[illotp] = cdc.[illotp]
	,[illotp_conv] = cdc.[illotp_conv]
	,[illotg] = cdc.[illotg]
	,[ilkit] = cdc.[ilkit]
	,[ilmmcu] = cdc.[ilmmcu]
	,[ilmmcu_conv] = cdc.[ilmmcu_conv]
	,[ildmct] = cdc.[ildmct]
	,[ildmct_conv] = cdc.[ildmct_conv]
	,[ildmcs] = cdc.[ildmcs]
	,[ilkco] = cdc.[ilkco]
	,[ilkco_conv] = cdc.[ilkco_conv]
	,[ildoc] = cdc.[ildoc]
	,[ildct] = cdc.[ildct]
	,[ilsfx] = cdc.[ilsfx]
	,[ilsfx_conv] = cdc.[ilsfx_conv]
	,[iljeln] = cdc.[iljeln]
	,[ilicu] = cdc.[ilicu]
	,[ildgl] = cdc.[ildgl]
	,[ildgl_conv] = cdc.[ildgl_conv]
	,[ilglpt] = cdc.[ilglpt]
	,[ildcto] = cdc.[ildcto]
	,[ildoco] = cdc.[ildoco]
	,[ilkcoo] = cdc.[ilkcoo]
	,[ilkcoo_conv] = cdc.[ilkcoo_conv]
	,[illnid] = cdc.[illnid]
	,[illnid_conv] = cdc.[illnid_conv]
	,[ilipcd] = cdc.[ilipcd]
	,[iltrdj] = cdc.[iltrdj]
	,[iltrdj_conv] = cdc.[iltrdj_conv]
	,[iltrum] = cdc.[iltrum]
	,[ilan8] = cdc.[ilan8]
	,[iltrex] = cdc.[iltrex]
	,[iltrex_conv] = cdc.[iltrex_conv]
	,[iltref] = cdc.[iltref]
	,[iltref_conv] = cdc.[iltref_conv]
	,[ilrcd] = cdc.[ilrcd]
	,[iltrqt] = cdc.[iltrqt]
	,[iltrqt_conv] = cdc.[iltrqt_conv]
	,[iluncs] = cdc.[iluncs]
	,[iluncs_conv] = cdc.[iluncs_conv]
	,[ilpaid] = cdc.[ilpaid]
	,[ilpaid_conv] = cdc.[ilpaid_conv]
	,[ilterm] = cdc.[ilterm]
	,[ilterm_conv] = cdc.[ilterm_conv]
	,[ilukid] = cdc.[ilukid]
	,[iltday] = cdc.[iltday]
	,[iluser] = cdc.[iluser]
	,[iluser_conv] = cdc.[iluser_conv]
	,[ilpid] = cdc.[ilpid]
	,[ilpid_conv] = cdc.[ilpid_conv]
	,[ilcrdj] = cdc.[ilcrdj]
	,[ilcrdj_conv] = cdc.[ilcrdj_conv]
	,[ilaid] = cdc.[ilaid]
	,[ilaid_conv] = cdc.[ilaid_conv]
	,[ilasid] = cdc.[ilasid]
	,[ilasid_conv] = cdc.[ilasid_conv]
	,[ilmcuz] = cdc.[ilmcuz]
	,[ilmcuz_conv] = cdc.[ilmcuz_conv]
	,[ilobj] = cdc.[ilobj]
	,[ilobj_conv] = cdc.[ilobj_conv]
	,[ilsbl] = cdc.[ilsbl]
	,[ilsbl_conv] = cdc.[ilsbl_conv]
	,[ilsub] = cdc.[ilsub]
	,[ilsub_conv] = cdc.[ilsub_conv]
	,[iluom2] = cdc.[iluom2]
	,[ilcmoo] = cdc.[ilcmoo]
	,[ilcmoo_conv] = cdc.[ilcmoo_conv]
	,[ilre] = cdc.[ilre]
	,[ilsblt] = cdc.[ilsblt]
	,[ilsqor] = cdc.[ilsqor]
	,[ilsqor_conv] = cdc.[ilsqor_conv]
	,[ilvpej] = cdc.[ilvpej]
	,[ilvpej_conv] = cdc.[ilvpej_conv]
	,[ilhdgj] = cdc.[ilhdgj]
	,[ilhdgj_conv] = cdc.[ilhdgj_conv]
	,[ilshan] = cdc.[ilshan]
	,[ilopsq] = cdc.[ilopsq]
	,[ilopsq_conv] = cdc.[ilopsq_conv]
	,[ilrfln] = cdc.[ilrfln]
	,[ilrfln_conv] = cdc.[ilrfln_conv]
	,[iltgn] = cdc.[iltgn]
	,[iltgn_conv] = cdc.[iltgn_conv]
	,[illotc] = cdc.[illotc]
	,[illotc_conv] = cdc.[illotc_conv]
	,[ilsvdt] = cdc.[ilsvdt]
	,[ilsvdt_conv] = cdc.[ilsvdt_conv]
	,[illrcd] = cdc.[illrcd]
	,[ilrlot] = cdc.[ilrlot]
	,[ilrlot_conv] = cdc.[ilrlot_conv]
	,[illpnu] = cdc.[illpnu]
	,[illpnu_conv] = cdc.[illpnu_conv]
	,[ilpmpn] = cdc.[ilpmpn]
	,[ilpmpn_conv] = cdc.[ilpmpn_conv]
	,[ilpns] = cdc.[ilpns] -- exclude distribution column
FROM stg_jde_qat.tmp_upsert_f4111_cdc cdc
WHERE
    rep_jde_qat.f4111_new.sys_integration_id = cdc.sys_integration_id
    AND rep_jde_qat.f4111_new.sys_cdc_scn < cdc.sys_cdc_scn 
OPTION ( LABEL = 'UPDATE_rep_jde_qat.f4111_new AF:{{ task_instance_key_str }}' ) 
